(function(a){a.fn.FXServiceCalculator=function(k){var b=this;b.prop("options",k);b.prop("params",{});b.prop("methods",{init:function(){var c=b.prop("options"),d=a('select[name="performanceFee"]',b),e=a('input[name="startDate"]',b),f=a('input[name="investAmount"]',b),g=a('input[type="submit"]',b),h=a("#fxs-calc-charts-"+c.uid);a(c.feeList).each(function(a,b){d.append('<option value="'+parseInt(b,10)+'">'+b+"%</option>\n")});d.on("change",function(){b.prop("methods").saveParam(a(this).attr("name"),
a(this).val())}).on("focus",function(){a(this).removeClass("valid-error")});"undefined"!=typeof c.performanceFee&&d.val(c.performanceFee).change();e.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0}).on("change",function(){b.prop("methods").saveParam(a(this).attr("name"),a(this).val())}).on("focus",function(){a(this).removeClass("valid-error")});"undefined"!=typeof c.startDate&&e.val(c.startDate).change();f.on("change",function(){b.prop("methods").saveParam(a(this).attr("name"),a(this).val())}).on("focus",
function(){a(this).removeClass("valid-error")});"undefined"!=typeof c.investAmount&&f.val(c.investAmount).change();a('input[name="reset"]',b).on("click",function(){b.prop("methods").update({})});a("form",b).submit(function(a){a.preventDefault();b.prop("methods").validate()&&(g.val("Please wait...").attr("disabled",!0),b.prop("methods").calculate(function(){g.val("Calculate").attr("disabled",null)}));return!1});b.prop("methods").validate(!1)&&b.prop("methods").calculate();h.tabs();a('a[href="#total-chart-'+
c.uid+'"]',h).on("click",function(){Highcharts.chart(a(a(this).attr("href"))[0],c.totalChartOptions)});a('a[href="#gl-chart-'+c.uid+'"]',h).on("click",function(){Highcharts.chart(a(a(this).attr("href"))[0],c.glChartOptions)});a('a[href="#fee-chart-'+c.uid+'"]',h).on("click",function(){Highcharts.chart(a(a(this).attr("href"))[0],c.feeChartOptions)})},saveParam:function(a,d){b.prop("params")[a]=d},calculate:function(c){var d=b.prop("options");b.prop("methods").switchCalcContent("spinner");a.post(d.adminUrl,
a.extend({action:"wdip-calculate-growth-data",accountId:d.accountId,serviceClient:d.serviceClient},b.prop("params")),function(d){d=d.success?d.data:{};b.prop("methods").update(d);a.isFunction(c)&&c()})},update:function(c){var d=!a.isEmptyObject(c)&&!a.isEmptyObject(c.totalChartOptions)&&0<c.totalChartOptions.series["0"].data.length,e=!a.isEmptyObject(c)&&!a.isEmptyObject(c.glChartOptions)&&0<c.glChartOptions.series["0"].data.length,f=!a.isEmptyObject(c)&&!a.isEmptyObject(c.feeChartOptions)&&0<c.feeChartOptions.series["0"].data.length;
if(d||e||f){b.prop("methods").switchCalcContent("charts");var d=parseFloat(c.totalAmount).toFixed(2),e=0<=d?"+":"",f=parseFloat(c.gainLosAmount).toFixed(2),g=0<=f?"+":"";a(".total-amount",b).text(e+d);a(".gain-loss-amount",b).text(g+f);a(".total-fee-amount",b).text("-"+parseFloat(c.feeAmount).toFixed(2)).addClass("down-amount");0<=d?a(".total-amount",b).removeClass("down-amount").addClass("up-amount"):a(".total-amount",b).removeClass("up-amount").addClass("down-amount");0<=f?a(".gain-loss-amount",
b).removeClass("down-amount").addClass("up-amount"):a(".gain-loss-amount",b).removeClass("up-amount").addClass("down-amount");b.prop("options").totalChartOptions=c.totalChartOptions;b.prop("options").glChartOptions=c.glChartOptions;b.prop("options").feeChartOptions=c.feeChartOptions;a('a[href^="#total-chart-"]',b).click()}else b.prop("methods").switchCalcContent(),b.prop("options").totalChartOptions.series=[],b.prop("options").glChartOptions.series=[],b.prop("options").feeChartOptions.series=[],a('input[name="investAmount"]',
b).val(null).removeClass("valid-error"),a('input[name="startDate"]',b).val(null).removeClass("valid-error"),a('select[name="performanceFee"]',b).val(null).removeClass("valid-error"),a('a[href^="#total-chart-"]',b).click(),a(".response-panel .role-text",b).each(function(){a(this).text("0.00").removeClass("down-amount").removeClass("up-amount")})},switchCalcContent:function(c){var d=b.prop("options"),e=a("#fxs-calc-default-text-"+d.uid,b),f=a("#fxs-calc-spinner-"+d.uid,b),d=a("#fxs-calc-charts-"+d.uid,
b);switch(c){case "spinner":e.attr("hidden",!0);f.attr("hidden",null);d.attr("hidden",!0);break;case "charts":e.attr("hidden",!0);f.attr("hidden",!0);d.attr("hidden",null);break;default:e.attr("hidden",null),f.attr("hidden",!0),d.attr("hidden",!0)}},validate:function(c){c="boolean"===a.type(c)?c:!0;var d=!0,e=b.prop("options"),f=a("#fxs-calc-invest-amount-"+e.uid),g=a("#fxs-calc-start-date-"+e.uid),e=a("#fxs-calc-performance-fee-"+e.uid);f.val()||(d=!1,c&&f.addClass("valid-error"));g.val()||(d=!1,
c&&g.addClass("valid-error"));e.val()||(d=!1,c&&e.addClass("valid-error"));return d}});b.prop("methods").init()}})(jQuery);
